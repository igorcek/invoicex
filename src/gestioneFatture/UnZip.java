/** * Invoicex * Copyright (c) 2005,2006,2007 Marco Ceccarelli, Tnx snc * * Questo software Ã¨ soggetto, e deve essere distribuito con la licenza * GNU General Public License, Version 2. La licenza accompagna il software * o potete trovarne una copia alla Free Software Foundation http://www.fsf.org . * * This software is subject to, and may be distributed under, the * GNU General Public License, Version 2. The license should have * accompanied the software or you may obtain a copy of the license * from the Free Software Foundation at http://www.fsf.org . * * -- * Marco Ceccarelli (m.ceccarelli@tnx.it) * Tnx snc (http://www.tnx.it) * */package gestioneFatture;import it.tnx.invoicex.GenericWorker;import java.io.BufferedInputStream;import java.io.BufferedOutputStream;import java.io.File;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.util.Enumeration;import java.util.zip.ZipEntry;import java.util.zip.ZipException;import java.util.zip.ZipFile;public class UnZip {    public static ZipFile zf;    public static final int EOF = -1;    public static String lastmsg = null;    public static boolean esito = false;    public static String firstfile = null;    public static String prefixdir = null;    public static void main(String[] argv) {        lastmsg = null;        esito = false;        main(argv, null);    }    public static void main(String[] argv, GenericWorker work) {        lastmsg = null;        esito = false;        Enumeration enum1;        if (argv.length == 1) {            try {                zf = new ZipFile(argv[0]);                enum1 = zf.entries();                while (enum1.hasMoreElements()) {                    ZipEntry target = (ZipEntry) enum1.nextElement();                    System.out.print(target.getName() + " .");                    if (work != null) {                        work.publicPublish("Unzip " + target);                    }                    saveEntry(target, work);                    if (firstfile == null) {                        firstfile = target.getName();                    }                    System.out.println(". unpacked");                }                esito = true;            } catch (FileNotFoundException e) {                lastmsg = "zipfile not found";                System.out.println("zipfile not found");            } catch (ZipException e) {                lastmsg = e.getMessage();                System.out.println("zip error...");            } catch (IOException e) {                lastmsg = e.getMessage();                System.out.println("IO error...");            }        } else {            System.out.println("Usage:java UnZip zipfile");        }    }    public static void unzip(File zipfile, File todir) {        try {            Enumeration enum1;            zf = new ZipFile(zipfile);            enum1 = zf.entries();            while (enum1.hasMoreElements()) {                ZipEntry target = (ZipEntry) enum1.nextElement();                System.out.print(target.getName() + " .");                saveEntryToDir(target, todir);                System.out.println(". unpacked");            }        } catch (FileNotFoundException e) {            System.out.println("zipfile not found");        } catch (ZipException e) {            System.out.println("zip error...");        } catch (IOException e) {            System.out.println("IO error...");        }    }    public static void saveEntryToDir(ZipEntry target, File todir) throws ZipException, IOException {        try {            File file = new File(todir.getAbsolutePath() + File.separator + target.getName());            if (target.isDirectory()) {                file.mkdirs();            } else {                InputStream is = zf.getInputStream(target);                BufferedInputStream bis = new BufferedInputStream(is);                if (file.getParent() != null) {                    File dir = new File(file.getParent());                    dir.mkdirs();                }                FileOutputStream fos = new FileOutputStream(file);                BufferedOutputStream bos = new BufferedOutputStream(fos);                int c;                byte[] buff = new byte[1024 * 32];                int writed = 0;                //while ((c = bis.read()) != EOF) {                int towrite = (int) target.getSize();                while ((c = bis.read(buff)) > 0) {                    writed += c;                    //bos.write((byte)c);                    bos.write(buff, 0, c);                }                bos.close();                fos.close();            }        } catch (ZipException e) {            throw e;        } catch (IOException e) {            throw e;        }    }    public static void saveEntry(ZipEntry target, GenericWorker work)            throws ZipException, IOException {        try {            File file = new File(target.getName());            if (target.isDirectory()) {                file.mkdirs();            } else {                InputStream is = zf.getInputStream(target);                BufferedInputStream bis = new BufferedInputStream(is);                if (file.getParent() != null) {                    File dir = new File((prefixdir != null ? prefixdir : "") + file.getParent());                    dir.mkdirs();                }                FileOutputStream fos = new FileOutputStream((prefixdir != null ? prefixdir : "") + file);                BufferedOutputStream bos = new BufferedOutputStream(fos);                int c;                byte[] buff = new byte[1204 * 32];                int writed = 0;                //while ((c = bis.read()) != EOF) {                int towrite = (int) target.getSize();                while ((c = bis.read(buff)) > 0) {                    writed += c;                    //bos.write((byte)c);                    bos.write(buff, 0, c);                    if (work != null) {                        work.publicPublish("Unzip " + target + " " + (writed * 100 / towrite) + "%");                    }                }                bos.close();                fos.close();            }        } catch (ZipException e) {            throw e;        } catch (IOException e) {            throw e;        }    }}